!function(a,b){if("function"==typeof define&&define.amd)define(["backbone","underscore","backbone.paginator"],function(c,d,e){return c.PageableCollection=e,a.Hal=b(a,c,d)});else if("undefined"!=typeof exports){var c=require("backbone"),d=require("underscore");c.PageableCollection=require("backbone.paginator"),module.exports=b(a,c,d)}else a.Hal=b(a,a.Backbone,a._)}(this,function(a,b,c){"use strict";var d={};return d.Error=function(a){this.name="HalError",this.message=a,this.stack=(new Error).stack,this.context=null,this.method=null},d.Error.prototype=new Error,d.ErrorHandler={capture:function(a,b,c){var e=new d.Error(a);throw e.method=b,e.context=c,e}},d.Embedded=b.Model.extend({set:function(a,e,f){var g;return null===a?this:("object"==typeof a?(g=a,f=e):(g={})[a]=e,c.map(g,function(g,h){if(g instanceof b.Model||g instanceof b.Collection||g instanceof d.Model||g instanceof d.Collection)b.Model.prototype.set.call(this,h,g,f);else if(c.isArray(g)){for(var i=[],j=0;j<g.length;++j)g[j]instanceof b.Model||g[j]instanceof b.Collection||g[j]instanceof d.Model||g[j]instanceof d.Collection?i.push(g[j]):i.push(new d.Model(g[j]));b.Model.prototype.set.call(this,h,i,f)}else c.isObject(g)?b.Model.prototype.set.call(this,h,new d.Model(g),f):c.isNull(g)||c.isUndefined(g)?b.Model.prototype.set.call(this,h,g,f):d.ErrorHandler.capture("Invalid embedded resource identified by 'rel'='"+h+"' !","Hal.Embedded.set",{embeddedResource:g,key:a,options:f,rel:h,val:e})},this),this)},toJSON:function(a){var b={},e=a||{};e.contentType||d.contentType||"application/json";for(var f in this.attributes){var g=this.attributes[f];if(c.isUndefined(g)||c.isNull(g))b[f]=g;else if(c.isArray(g)){b[f]=[];for(var h=0;h<g.length;++h)c.isUndefined(g[h])||c.isNull(g[h])?b[f].push(g[h]):b[f].push(g[h].toJSON(e))}else b[f]=g.toJSON(e)}return b}}),d.Link=b.Model.extend({_templated:void 0,createModel:function(){return new d.Model({id:parseInt(this.get("href").split("/").pop(),10)})},initialize:function(a){c.isObject(a)&&c.isString(a.href)||d.ErrorHandler.capture('Missing required property "href" !',"Hal.Link.initialize",{options:a}),this._templated=this.get("templated"),this.attributes.templated=this._templated===!0,this.on("change:templated",function(a,b,c){this._templated=b},this)},getDeprecation:function(){return this.get("deprecation")},getName:function(){return this.get("name")},getHref:function(){return this.get("href")},getHreflang:function(){return this.get("hreflang")},getProfile:function(){return this.get("profile")},getTitle:function(){return this.get("title")},getType:function(){return this.get("type")},isArray:function(){return!1},isTemplated:function(){return this.get("templated")},setDeprecation:function(a){this.set("deprecation",a)},setHref:function(a){this.set("href",a)},setHreflang:function(a){this.set("hreflang",a)},setName:function(a){this.set("name",a)},setProfile:function(a){this.set("profile",a)},setTemplated:function(a){this.set("templated",a)},setTitle:function(a){this.set("title",a)},setType:function(a){this.set("type",a)},toJSON:function(a){return c.isUndefined(this._templated)&&delete this.attributes.templated,b.Model.prototype.toJSON.apply(this)}}),d.LinkArray=b.Collection.extend({model:d.Link,initialize:function(a,e){return c.isArray(a)&&0!==a.length||d.ErrorHandler.capture("A LinkArray MUST BE created with at least one link model !","Hal.LinkArray.initialize",{models:a,options:e}),b.Collection.prototype.initialize.apply(this,a,e)},isArray:function(){return!0}}),d.Links=b.Model.extend({getSelf:function(){return this.get("self")},hasSelf:function(){var a=this.getSelf();return!(c.isNull(a)||c.isUndefined(a))},set:function(a,e,f){var g;return null===a?this:("object"==typeof a?(g=a,f=e):(g={})[a]=e,c.map(g,function(g,h){g instanceof d.Link?b.Model.prototype.set.call(this,h,g,f):c.isArray(g)?b.Model.prototype.set.call(this,h,new d.LinkArray(g),f):c.isObject(g)?b.Model.prototype.set.call(this,h,new d.Link(g),f):c.isNull(g)||c.isUndefined(g)?b.Model.prototype.set.call(this,h,g,f):d.ErrorHandler.capture("Invalid embedded identified by 'rel'='"+h+"' !","Hal.Links.set",{key:a,link:g,options:f,rel:h,val:e})},this),this)},toJSON:function(a){var b={},e=a||{};e.contentType||d.contentType||"application/json";for(var f in this.attributes){var g=this.attributes[f];c.isNull(g)||c.isUndefined(g)?b[f]=g:b[f]=g.toJSON(e)}return b}}),d.Model=b.Model.extend({_links:null,_embedded:null,clone:function(){return new this.constructor(this.toJSON({contentType:"application/hal+json"}))},hasEmbedded:function(a){return this._embedded.has(a)},hasLink:function(a){return this._links.has(a)},getEmbedded:function(a){var b=this._embedded;return c.isString(a)&&(b=b.get(a)),b},getLink:function(a){return this.getLinks().get(a)},getLinks:function(){return this._links},setEmbedded:function(a,b){this.getEmbedded().set(a,b)},unsetEmbedded:function(a,b){this.getEmbedded().unset(a,b)},unsetLink:function(a,b){this.getLinks().unset(a,b)},initialize:function(a){this._links=this._links||new d.Links,this._embedded=this._embedded||new d.Embedded},toJSON:function(a){var b=c.isEmpty(this.getLinks().attributes),e=c.isEmpty(this.getEmbedded().attributes),f=null,g=a||{},h=g.contentType||d.contentType||"application/json";return"application/json"===h?f=c.extend({},this.attributes,this.getEmbedded().toJSON(g)):"application/hal+json"===h&&(f=b&&e?c.clone(this.attributes):b?c.extend({},this.attributes,{_embedded:this.getEmbedded().toJSON(g)}):e?c.extend({},this.attributes,{_links:this.getLinks().toJSON(g)}):c.extend(c.clone(this.attributes),{_embedded:this.getEmbedded().toJSON(g),_links:this.getLinks().toJSON(g)})),f},set:function(a,e,f){var g;return null===a?this:("object"==typeof a?(g=a,f=e):(g={})[a]=e,g._links&&(this._links?this._links.set(g._links):this._links=new d.Links(g._links)),g._embedded&&(this._embedded?this._embedded.set(g._embedded):this._embedded=new d.Embedded(g._embedded)),g=c.omit(g,"_links","_embedded"),b.Model.prototype.set.call(this,g,f,void 0))},url:function(){if(this.getLinks().hasSelf())return this.getLinks().getSelf().getHref();var a=c.result(this,"urlRoot")||c.result(this.collection,"url"),b=c.result(d,"urlRoot"),e=c.result(this,"urlMiddle");if(!a&&c.isString(b)&&(a=b,c.isString(e)&&(a=a.replace(/([^\/])$/,"$1/")+e)),a||d.ErrorHandler.capture('A "url" property or function must be specified !',"Hal.Model.url",{base:a,halUrlRoot:b,urlMiddle:e}),this.isNew())return a;var f=this.id||this.attributes[this.idAttribute];return a.replace(/([^\/])$/,"$1/")+encodeURIComponent(f)}}),function(){function a(a,b){if(!c.isNumber(a)||c.isNaN(a)||!c.isFinite(a)||~~a!==a)throw new TypeError("`"+b+"` must be a finite integer");return a}d.Collection=b.PageableCollection.extend({mode:"infinite",model:d.Model,queryParams:{currentPage:"page",pageSize:"page_size",totalPages:null,totalRecords:null},state:{firstPage:1,pageSize:12},parseLinks:function(a,b){a._links.first||"infinite"!==this.mode||0===a.total_items||d.ErrorHandler.capture("You are using the 'infinite' mode and the server did not returned a 'first' link attached to the HAL Collection. Check if the collection URL is correct and the payload is well formed. If your collection is not paginated you could use the 'server' mode instead.","Hal.Collection.parseLinks",{resp:a,xhr:b}),a._links.last||"infinite"!==this.mode||0===a.total_items||d.ErrorHandler.capture("You are using the 'infinite' mode and the server did not returned a 'last' link attached to the HAL Collection. Check if the collection URL is correct and the payload is well formed. If your collection is not paginated you could use the 'server' mode instead.","Hal.Collection.parseLinks",{resp:a,xhr:b});var c={};return 0!==a.total_items&&(c.first=a._links.first.href,c.last=a._links.last.href),a._links.next&&(c.next=a._links.next.href),a._links.prev&&(c.prev=a._links.prev.href),c},parseRecords:function(a,b){return this.rel||d.ErrorHandler.capture("A 'rel' parameter is required !","Hal.Collection.parseRecords",{rel:this.rel,resp:a,options:b}),a._embedded[this.rel]},parseState:function(a,b,c,d){return{totalItems:a.total_items}},getPage:function(b,d){var e=this.mode,f=this.fullCollection;d=d||{fetch:!1};var g=this.state,h=g.firstPage,i=g.currentPage,j=g.lastPage,k=g.pageSize,l=b;switch(b){case"first":l=h;break;case"prev":l=i-1;break;case"next":l=i+1;break;case"last":l=j;break;default:l=a(b,"index")}this.state=this._checkState(c.extend({},g,{currentPage:l})),d.from=i,d.to=l;var m=(0===h?l:l-1)*k,n=f&&f.length?f.models.slice(m,m+k):[];return"client"!=e&&("infinite"!=e||c.isEmpty(n))||d.fetch?("infinite"==e&&(d.url=this.links[l]),this.fetch(c.omit(d,"fetch"))):(this.reset(n,c.omit(d,"fetch")),d.success(n,null,d),this)}})}(),d});
//# sourceMappingURL=backbone.hateoas.min.js.map